syntax = "proto3";

package icn.director.bft;

// BFT Coordination Service for embedding exchange between elected directors
service BftCoordination {
  // Exchange CLIP embeddings with another director
  rpc ExchangeEmbedding(EmbeddingRequest) returns (EmbeddingResponse);

  // Health check
  rpc Ping(PingRequest) returns (PingResponse);
}

// Request to exchange embedding for a specific slot
message EmbeddingRequest {
  // Slot number for which this embedding is generated
  uint64 slot = 1;

  // PeerId of the requesting director (for verification)
  string peer_id = 2;

  // CLIP embedding vector (512 dimensions for CLIP-ViT-B-32)
  repeated float embedding = 3;

  // Signature over (slot || peer_id || embedding_hash) for authenticity
  bytes signature = 4;
}

// Response containing the responder's embedding
message EmbeddingResponse {
  // Slot number (must match request)
  uint64 slot = 1;

  // PeerId of the responding director
  string peer_id = 2;

  // CLIP embedding vector from this director
  repeated float embedding = 3;

  // Signature over (slot || peer_id || embedding_hash)
  bytes signature = 4;
}

// Ping request for health check
message PingRequest {
  string peer_id = 1;
}

// Ping response
message PingResponse {
  string peer_id = 1;
  uint64 current_slot = 2;
}
